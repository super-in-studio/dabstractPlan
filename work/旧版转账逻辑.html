<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-de0c9658-8371-4d62-aa62-bd91fe73e5e9"></attachment><p>--------------------------------转账逻辑-----------------------------------------</p><p>1,用redis 锁住双方的币种钱包，userId 为锁的key</p><p>2,检测转账方账号是否正常</p><p>3,检查支付密码是否正确</p><p>4,获取收款方钱包</p><p>5,校验手续费是否一致</p><p>6,计算转账总金额：转账金额 + 手续费</p><p>7.----------------资金操作流水对象创建--------------------------</p><p>7.1，如果转账方的被锁定的金额 &gt;= 转账总金额 ，上锁,上锁金额增加</p><p>7.2，如果转账方的被锁定的金额 &lt; 转账总金额, 直接增加余额</p><p>8.-----------------------更新账户余额---------------------------</p><p>8.1 判断用户转账方是否被锁，被锁后从DB 拿回账户数据</p><p>8.2 如果没有账户就新建一个</p><p>8.3 流水对象的余额+账户余额 ，如果为负数就报余额不足</p><p>8.4 流水对象的冻结资金+账户余额 ，如果为负数就报余额不足</p><p>8.5 流水对象的锁定资金+账户余额 ，如果为负数就报余额不足</p><p>8.6 设置资金的余额</p><p>8.8 失败重试</p><p>8.9 成功的话 就更新资产流水 和发mq</p><p><br></p>