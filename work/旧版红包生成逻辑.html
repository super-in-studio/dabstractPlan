<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-6d0ff9fc-5f88-4fbe-8dc0-2522405f7c8f"></attachment><p>1，入口com.lxtx.im.api.web.api.app.ApiRedPacketController.send(RedPacketSendReq)</p><p>1，获取发红包的用户钱包Id</p><p>2,根据前端入参判断 判断是否为个人红包或者是群组红包</p><p>2.1 个人红包逻辑：</p><p>2.1.1, 判断接收人的钱包是否被发送人拉黑</p><p>2.1.2，如果不是，获取接收人的钱包id</p><p>2.1.3,获取的特殊国家列表,获取特殊处理国家显示币种,&nbsp;获取好友国家列表</p><p>2.1.4 判断转账接收方所在的国家是否是特殊列表中的国家，如果是则提示 对方无法收款.</p><p>2.1.5  判断发送者钱包密码是否正确</p><p>2.1.6  获取手续费并与前端计算值判断</p><p>2.1.7  以上判断都通过后，用发送者钱包id获取锁</p><p>2.1.8 判断发送者钱包的余额是否充足</p><p>2.1.9 ------------涉及资产修改公共方法-------------------</p><ul><li>流水对象的余额+账户余额 ，如果为负数就报余额不足</li><li>流水对象的冻结资金+账户余额 ，如果为负数就报余额不足</li><li>流水对象的锁定资金+账户余额 ，如果为负数就报余额不足</li><li>设置资金的余额</li><li>失败重试10次</li><li>成功的话 就更新资产流水 和发mq</li></ul><p><br></p>