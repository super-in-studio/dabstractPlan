<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-195b6858-bd1c-48dc-b54f-c9e6b58191a6"></attachment><p>#!/bin/bash</p><p>&nbsp;</p><p>COMMOND_HOME=D:/software/Redis-x64-3.0.501/Redis-x64-3.0.501/redis-cli</p><p>pattern=$1</p><p>masterNodeAdress=192.168.10.201</p><p>masterNodePort=7000</p><p>password=passwD9923</p><p>echo "batch del keys ${pattern}"&nbsp;</p><p>#batch del redis cluster</p><p>#1. fetch master nodes hostandport</p><p><br></p><p>echo "1. fetch master nodes hostandport"</p><p>HostAndPort=`${COMMOND_HOME} -c -h ${masterNodeAdress} -c -p ${masterNodePort} -a ${password} cluster nodes|grep master|awk '{print $2}'|awk -F "@" '{print $1}'`</p><p>&nbsp;</p><p>#2. iter HostAndPort array to del keys by pattern</p><p>echo "2. iter HostAndPort array to del keys by pattern"</p><p>for node in ${HostAndPort[@]}</p><p>&nbsp;do</p><p>&nbsp;&nbsp;echo "start batch del ${node} keys ${pattern}"</p><p>&nbsp;&nbsp;ip=`echo ${node}|cut -d : -f 1`</p><p>&nbsp;&nbsp;port=`echo ${node}|cut -d : -f 2`</p><p>&nbsp;&nbsp;items=`${COMMOND_HOME} -h ${ip} -p ${port} -a ${password} scan 0 match ${pattern} count 1000 |awk 'NR&gt;1 {print $1}'`</p><p>&nbsp;&nbsp;echo "${items[@]}"</p><p>&nbsp;&nbsp;for key in ${items}</p><p>&nbsp;&nbsp;	do</p><p>&nbsp;&nbsp;		formateKey=`echo ${key}|awk '{print $1}'`</p><p>&nbsp;&nbsp;		echo "${COMMOND_HOME} -c -h ${ip} -p ${port} -a ${password} del ${formateKey[@]} hello"</p><p>&nbsp;&nbsp;		${COMMOND_HOME} -c -h ${ip} -p ${port} -a ${password} del ${formateKey[@]}</p><p>&nbsp;&nbsp;		sleep 0.5&nbsp;&nbsp;</p><p>&nbsp;&nbsp;	done</p><p>&nbsp;done</p><p>echo "completed"</p><p><br></p>