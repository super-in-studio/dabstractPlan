<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-41415574-2fe1-4960-a42b-e09379798a8a"></attachment><p>&nbsp;Spring的单例对象的初始化主要分为三步：&nbsp;</p><p><br></p><p><br></p><p>&nbsp;&nbsp;①：createBeanInstance：实例化，其实也就是 调用对象的构造方法实例化对象</p><p><br></p><p>&nbsp;&nbsp;②：populateBean：填充属性，这一步主要是多bean的依赖属性进行填充</p><p><br></p><p>&nbsp;&nbsp;③：initializeBean：调用spring xml中的init() 方法。</p><p><br></p><p>从上面讲述的单例bean初始化步骤我们可以知道，循环依赖主要发生在第一、第二步。也就是构造器循环依赖和field循环依赖。</p><p><br></p><p>那么我们要解决循环引用也应该从初始化过程着手，对于单例来说，在Spring容器整个生命周期内，有且只有一个对象，所以很容易想到这个对象应该存在Cache中，Spring为了解决单例的循环依赖问题，使用了三级缓存。</p><p>这三级缓存分别指：</p><p><br></p><p>&nbsp;singletonFactories ： 单例对象工厂的cache&nbsp;</p><p>&nbsp;earlySingletonObjects ：提前暴光的单例对象的Cache 。【用于检测循环引用，与singletonFactories互斥】</p><p>&nbsp;singletonObjects：单例对象的cache</p><p><br></p><p><br></p>