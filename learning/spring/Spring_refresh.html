<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-ce47502d-e4ba-4fc9-93aa-c3b74a0ef095"></attachment><p>进入spring 初始化refresh context 阶段：</p><p>1 prepareRefresh ：</p><p>（1）根据不同的环境初始化，一般都是初始化servlet config 和 servlet context , 让容器具备web的功能</p><p>（2） 配置属性验空</p><p><br></p><p>2.prepareBeanFactory</p><p>（1） 准备beanFactory , 其实就是把class ,环境变量，配置信息 放入DefaultListableFactory , 方便拿出调用</p><p><br></p><p>3.postProcessBeanFactory</p><p>（1） 增加servlet config , servlet context 后置处理</p><p>（2） 初始化 web 容器应用范围对象，request ,session ,globle Session,globle application 做成bean 塞入 beanfactory</p><p>(3) servletContext , servletConfig 和 servlet 的变量也塞入 beanFactory</p><p><br></p><p>4.invokeBeanFactoryPostProcessors</p><p>(1) beanFactory 后置处理器 感觉没啥用</p><p><br></p><p>5.registerBeanPostProcessors 注册bean 后置处理器</p><p>（1）从beanFactory 中获取实现 BeanPostProcessor 接口bean</p><p>( 2 ) 将这些bean 再放入 beanFactory 中的后置处理器列表中</p><p><br></p><p>6.initMessageSource 没什么用</p><p>7.initApplicationEventMulticaster 初始化事件分发器</p><p>8.onRefresh 官方解析：在指定的子容器内初始化其他的bean</p><p>9.registerListeners 将实现了ApplicationListener 接口加入事件分发器中</p><p><br></p><p>10.finishBeanFactoryInitialization ， （bean 初始化 org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(String, RootBeanDefinition, Object[])）</p><p>处理：</p><p>（1）org.springframework.beans.factory.config.InstantiationAwareBeanPostProcessor.postProcessBeforeInstantiation(Class&lt;?&gt;, String) bean 实例化前的后置处理器</p><p> (1.2)org.springframework.context.support.ApplicationContextAwareProcessor.invokeAwareInterfaces(Object) 处理意识类：EnvironmentAware，EmbeddedValueResolverAware，ResourceLoaderAware，ApplicationEventPublisherAware，MessageSourceAware，ApplicationContextAware.</p><p>  (1.3) org.springframework.beans.factory.InitializingBean.afterPropertiesSet()</p><p>（2）org.springframework.beans.factory.config.BeanPostProcessor.postProcessAfterInitialization(Object, String) 实例化后的后置处理器</p><p>（3）org.springframework.beans.PropertyEditorRegistry bean 自定义属性</p><p>（4）org.springframework.beans.factory.support.MergedBeanDefinitionPostProcessor.postProcessMergedBeanDefinition(RootBeanDefinition, Class&lt;?&gt;, String) 合并bean定义后置处理器</p><p>（5） org.springframework.beans.factory.config.InstantiationAwareBeanPostProcessor   bean实例化意识后置处理器</p><p>（6）注册 org.springframework.beans.factory.config.DestructionAwareBeanPostProcessor  bean 销毁后处理器</p><p>（7） bean 实例化阶段失败</p><p>（8） 跑 org.springframework.beans.factory.SmartInitializingSingleton.afterSingletonsInstantiated()  逻辑</p><p><br></p><p><br></p><p><br></p>