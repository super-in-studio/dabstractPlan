<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-76d70fb1-0f98-4117-92d4-e5d9dfa108f8"></attachment><p>1.去重</p><p><br></p><p>db.collection.aggregate([</p><p><br></p><p>&nbsp;&nbsp;{$group: { _id:{name:"$tag.SHELTERNAME",address:"$tag.ADDRESS"}, total : { $sum : 1},dups: {$addToSet: '$_id'}}},&nbsp;&nbsp;&nbsp;//分组</p><p><br></p><p>{$match: { total:{"$gt":1}}},&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//筛选</p><p><br></p><p>//需要显示的字段</p><p>&nbsp;&nbsp;{$project: {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;_id :1,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;totol:{$districe:["$total",1]}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;type:"type"</p><p>&nbsp;&nbsp;}},</p><p>&nbsp;&nbsp;{$group: { _id:{type:"$type"}, num : { $sum : "$total"}}}</p><p>],{ allowDiskUse: true })</p><p><br></p><p><br></p>