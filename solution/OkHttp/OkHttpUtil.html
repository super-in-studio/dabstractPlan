<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-272f3b75-f6df-42f5-9225-bc8b0f129e83"></attachment><p><br></p><p><br></p><p>&nbsp;&nbsp;private static final Logger logger = LoggerFactory.getLogger(OkHttpUtil.class);</p><p><br></p><p>&nbsp;&nbsp;private static OkHttpClient client = new OkHttpClient.Builder()</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.connectTimeout(60, TimeUnit.SECONDS)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.readTimeout(60, TimeUnit.SECONDS)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();</p><p><br></p><p>&nbsp;&nbsp;public static String get(String url, Map&lt;String, Object&gt; headers) throws Exception {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;logger.info("&gt;&gt;&gt; okHttpUtil get request, url:[{}], headers:[{}]", url, headers);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Builder requestBuilder = new Request.Builder();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if (!CollectionUtils.isEmpty(headers)) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (Map.Entry&lt;String, Object&gt; header : headers.entrySet()) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestBuilder.addHeader(header.getKey(), header.getValue().toString());</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;Request request = requestBuilder</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.get()</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.url(url)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;Response response = null;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;String respBody = null;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;try {</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ######################################### TODO 测试用 ############################################################</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置代理,需要替换</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Proxy proxy = new Proxy(Proxy.Type.SOCKS, new InetSocketAddress("192.168.11.33", 1080));</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client = client.newBuilder().proxy(proxy).build();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ############################################## END #######################################################</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response = client.newCall(request).execute();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;respBody = response.body().string();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;} catch (Exception e) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(e.getMessage(), e);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (response != null) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.close();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw e;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;} finally {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info("&gt;&gt;&gt; okHttpUtil get response, url:[{}], result:[{}]", url, respBody);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;return respBody;</p><p>&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;public static String get(String url) throws Exception {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;return get(url, null);</p><p>&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;public static String post(String url, String jsonBodyParams, Map&lt;String, Object&gt; headers) throws Exception {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;logger.info("&gt;&gt;&gt; okHttpUtil post request, url:[{}], jsonBodyParams:[{}], headers:[{}]", url, jsonBodyParams, headers);</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//表单请求参数</p><p>&nbsp;&nbsp;&nbsp;&nbsp;FormBody.Builder bodyBuilder = new FormBody.Builder();</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;RequestBody body = bodyBuilder.build();</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//设置body请求参数</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if (jsonBodyParams != null) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body = RequestBody.create(MediaType.parse("application/json; charset=utf-8"), jsonBodyParams);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//设置请求头部信息</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Builder requestBuilder = new Request.Builder();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if (!CollectionUtils.isEmpty(headers)) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (Map.Entry&lt;String, Object&gt; header : headers.entrySet()) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestBuilder.addHeader(header.getKey(), header.getValue().toString());</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//封装request请求对象</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Request request = requestBuilder</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.post(body)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.url(url)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//发送post请求</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Response response = null;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;String respBody = null;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;try {</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ######################################### TODO 测试用 ############################################################</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置代理,需要替换</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Proxy proxy = new Proxy(Proxy.Type.SOCKS, new InetSocketAddress("192.168.11.33", 1080));</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client = client.newBuilder().proxy(proxy).build();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ############################################## END #######################################################</p><p><br></p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response = client.newCall(request).execute();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;respBody = response.body().string();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;} catch (Exception e) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (response != null) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.close();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw e;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;} finally {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info("&gt;&gt;&gt; okHttpUtil post response, url:[{}], result:[{}]", url, JSONObject.toJSONString(respBody));</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;return respBody;</p><p>&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;public static String post(String url, String bodyParams) throws Exception {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;return post(url, bodyParams, null);</p><p>&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;public static String put(String url, String jsonBodyParams, Map&lt;String, Object&gt; headers) throws Exception {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;logger.info("&gt;&gt;&gt; okHttpUtil put request, url:[{}], jsonBodyParams:[{}], headers:[{}]", url, jsonBodyParams, headers);</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//设置body请求参数</p><p>&nbsp;&nbsp;&nbsp;&nbsp;FormBody.Builder formBody = new FormBody.Builder();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if (!StringUtils.isEmpty(jsonBodyParams)) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JSONObject jsonObject = JSONObject.parseObject(jsonBodyParams);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jsonObject.keySet().forEach(s -&gt; formBody.add(s, String.valueOf(jsonObject.get(s))));</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;RequestBody body = formBody.build();</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//设置请求头部信息</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Builder requestBuilder = new Request.Builder();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if (!CollectionUtils.isEmpty(headers)) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (Map.Entry&lt;String, Object&gt; header : headers.entrySet()) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requestBuilder.addHeader(header.getKey(), header.getValue().toString());</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//封装request请求对象</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Request request = requestBuilder</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.put(body)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.url(url)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;//发送post请求</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Response response = null;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;String respBody = null;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;try {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response = client.newCall(request).execute();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;respBody = response.body().string();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;} catch (Exception e) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (response != null) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.close();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw e;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;} finally {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info("&gt;&gt;&gt; okHttpUtil put response, url:[{}], result:[{}]", url, respBody);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;return respBody;</p><p>&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;public static void main(String[] args) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;params.put("test", "1");</p><p>&nbsp;&nbsp;&nbsp;&nbsp;//TODO 测试该create方法</p><p>&nbsp;&nbsp;&nbsp;&nbsp;RequestBody body = RequestBody.create(JSONObject.toJSONString(params), MediaType.parse("application/json; charset=utf-8"));</p><p>&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(11);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(body);</p><p>&nbsp;&nbsp;}</p><p><br></p>