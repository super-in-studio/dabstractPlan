<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-5d74eca8-2ddc-44b0-9c7f-adc2bd5cdd64"></attachment><p>jps -l 查看java进程</p><p>jmap -heap {pid}查看堆使用请求</p><p>jstat -gcutil {pid} 查看垃圾回收情况.</p><p>jinfo -flags {pid} 查看配置参数</p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">S0: Survivor 0区的空间使用率 Survivor space 0 utilization as a percentage of the space's current capacity.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">S1: Survivor 1区的空间使用率 Survivor space 1 utilization as a percentage of the space's current capacity.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">E: Eden区的空间使用率 Eden space utilization as a percentage of the space's current capacity.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">O: 老年代的空间使用率 Old space utilization as a percentage of the space's current capacity.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">M: 元数据的空间使用率 Metaspace utilization as a percentage of the space's current capacity.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">CCS: 类指针压缩空间使用率 Compressed class space utilization as a percentage.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">YGC: 新生代GC次数 Number of young generation GC events.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">YGCT: 新生代GC总时长（从应用程序启动到采样时年轻代中gc所用时间 单位：s）</span></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);"> Young generation garbage collection time.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">FGC: Full GC次数 Number of full GC events.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">FGCT: Full GC总时长（从应用程序启动到采样时old代(全gc)gc所用时间 单位：s）</span></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);"> Full garbage collection time.</span></p><p><br></p><p><span style="background-color: rgb(40, 44, 52); color: rgb(171, 178, 191);">GCT: 总共的GC时长 （从应用程序启动到采样时gc用的总时间 单位：s）Total garbage collection time.</span></p><p><br></p><p><br></p><p>通过这一个多月的调优总结出以下几点：</p><p><br></p><p><br></p><ul><li>FullGC一天超过一次肯定就不正常了</li><li>发现FullGC频繁的时候优先调查内存泄漏问题</li><li>内存泄漏解决后，jvm可以调优的空间就比较少了，作为学习还可以，否则不要投入太多的时间</li><li>如果发现CPU持续偏高，排除代码问题后可以找运维咨询下阿里云客服，这次调查过程中就发现CPU 100%是由于服务器问题导致的，进行服务器迁移后就正常了。</li><li>数据查询的时候也是算作服务器的入口流量的，如果访问业务没有这么大量，而且没有攻击的问题的话可以往数据库方面调查</li><li>有必要时常关注服务器的GC，可以及早发现问题</li></ul><p><br></p><p><br></p><p>----------------------------------------------------------------------------------调优参数参考-------------------------------------------------------------------------------------------------------------------------------------------------</p><p><span style="background-color: rgb(245, 245, 245);">java -Xmx3550m -Xms3550m -Xss128k -</span><span class="hljs-string" style="color: rgb(163, 21, 21);">XX:</span><span style="background-color: rgb(245, 245, 245);">NewRatio=</span><span class="hljs-number">4</span><span style="background-color: rgb(245, 245, 245);"> -</span><span class="hljs-string" style="color: rgb(163, 21, 21);">XX:</span><span style="background-color: rgb(245, 245, 245);">SurvivorRatio=</span><span class="hljs-number">4</span><span style="background-color: rgb(245, 245, 245);"> -</span><span class="hljs-string" style="color: rgb(163, 21, 21);">XX:</span><span style="background-color: rgb(245, 245, 245);">MaxPermSize=</span><span class="hljs-number">16</span><span style="background-color: rgb(245, 245, 245);">m -</span><span class="hljs-string" style="color: rgb(163, 21, 21);">XX:</span><span style="background-color: rgb(245, 245, 245);">MaxTenuringThreshold=</span><span class="hljs-number">0</span></p><p><span class="hljs-deletion" style="color: rgb(43, 145, 175);">-Xmx3550m：设置JVM最大可用内存为3550M。</span></p><p><br></p><p><span class="hljs-deletion" style="color: rgb(43, 145, 175);">-Xms3550m：设置JVM促使内存为3550m。此值可以设置与-Xmx相同，以避免每次垃圾回收完成后JVM重新分配内存。</span></p><p><br></p><p><span class="hljs-deletion" style="color: rgb(43, 145, 175);">-Xmn2g：设置年轻代大小为2G。整个堆大小=年轻代大小 + 年老代大小 + 持久代大小。持久代一般固定大小为64m，所以增大年轻代后，将会减小年老代大小。此值对系统性能影响较大，Sun官方推荐配置为整个堆的3/8。</span></p><p><br></p><p><span class="hljs-deletion" style="color: rgb(43, 145, 175);">-Xss128k：设置每个线程的堆栈大小。JDK5.0以后每个线程堆栈大小为1M，以前每个线程堆栈大小为256K。更具应用的线程所需内存大小进行调整。在相同物理内存下，减小这个值能生成更多的线程。但是操作系统对一个进程内的线程数还是有限制的，不能无限生成，经验值在3000~5000左右。</span></p><p><br></p><p><span style="background-color: rgb(245, 245, 245);">-</span><span class="hljs-string" style="color: rgb(163, 21, 21);">XX:</span><span style="background-color: rgb(245, 245, 245);">NewRatio=</span><span class="hljs-number">4</span><span style="background-color: rgb(245, 245, 245);">:设置年轻代（包括Eden和两个Survivor区）与年老代的比值（除去持久代）。设置为</span><span class="hljs-number">4</span><span style="background-color: rgb(245, 245, 245);">，则年轻代与年老代所占比值为</span><span class="hljs-number">1</span><span style="background-color: rgb(245, 245, 245);">：</span><span class="hljs-number">4</span><span style="background-color: rgb(245, 245, 245);">，年轻代占整个堆栈的</span><span class="hljs-number">1</span><span style="background-color: rgb(245, 245, 245);">/</span><span class="hljs-number">5</span></p><p><br></p><p><span style="background-color: rgb(245, 245, 245);">-</span><span class="hljs-string" style="color: rgb(163, 21, 21);">XX:</span><span style="background-color: rgb(245, 245, 245);">SurvivorRatio=</span><span class="hljs-number">4</span><span style="background-color: rgb(245, 245, 245);">：设置年轻代中Eden区与Survivor区的大小比值。设置为</span><span class="hljs-number">4</span><span style="background-color: rgb(245, 245, 245);">，则两个Survivor区与一个Eden区的比值为</span><span class="hljs-number">2</span><span style="background-color: rgb(245, 245, 245);">:</span><span class="hljs-number">4</span><span style="background-color: rgb(245, 245, 245);">，一个Survivor区占整个年轻代的</span><span class="hljs-number">1</span><span style="background-color: rgb(245, 245, 245);">/</span><span class="hljs-number">6</span></p><p><br></p><p><span style="background-color: rgb(245, 245, 245);">-</span><span class="hljs-string" style="color: rgb(163, 21, 21);">XX:</span><span style="background-color: rgb(245, 245, 245);">MaxPermSize=</span><span class="hljs-number">16</span><span class="hljs-string" style="color: rgb(163, 21, 21);">m:</span><span style="background-color: rgb(245, 245, 245);">设置持久代大小为</span><span class="hljs-number">16</span><span style="background-color: rgb(245, 245, 245);">m。</span></p><p><br></p><p><span style="background-color: rgb(245, 245, 245);">-</span><span class="hljs-string" style="color: rgb(163, 21, 21);">XX:</span><span style="background-color: rgb(245, 245, 245);">MaxTenuringThreshold=</span><span class="hljs-number">0</span><span style="background-color: rgb(245, 245, 245);">：设置垃圾最大年龄。如果设置为</span><span class="hljs-number">0</span><span style="background-color: rgb(245, 245, 245);">的话，则年轻代对象不经过Survivor区，直接进入年老代。对于年老代比较多的应用，可以提高效率。如果将此值设置为一个较大值，则年轻代对象会在Survivor区进行多次复制，这样可以增加对象再年轻代的存活时间，增加在年轻代即被回收的概论。</span></p><p><br></p><p><br></p><p><br></p><p>默认jvm参数------java -XX:+PrintFlagsInitial</p><p>1.堆内存默认大小 为本机内存的最小64分之1,最大值4分1,推荐配置最大最小值一致，防止堆重新分配内存</p><p>2.新生代默认与老年代比例为1:2 ， 也就是整个堆内存的3分1</p><p>3.两个surivor 默认比例是新生代的2:8 ，也就是整个堆内存的12分支1</p><p>4.mateSpace 元数据区 默认是20M</p><p><br></p><p><br></p><p><br></p><p><span style="background-color: rgb(245, 245, 245);">元数据区调优:原因就是metaSpaceSize 的gc 阀值默认</span></p><p><br></p>