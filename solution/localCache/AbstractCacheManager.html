<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-c6108939-1ceb-4bbf-ae69-ed7b353c87b7"></attachment><p><br></p><p>public abstract class AbstractCacheManager implements CacheManager, Destroyable {</p><p><br></p><p><br></p><p>&nbsp;&nbsp;private final ConcurrentMap&lt;String, Cache&gt; caches;</p><p><br></p><p>&nbsp;&nbsp;public AbstractCacheManager() {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;this.caches = new ConcurrentHashMap&lt;String, Cache&gt;();</p><p>&nbsp;&nbsp;}</p><p><br></p><p><br></p><p>&nbsp;&nbsp;public &lt;K, V&gt; Cache&lt;K, V&gt; getCache(String name) throws IllegalArgumentException, CacheException {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if (!StringUtils.hasText(name)) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new IllegalArgumentException("Cache name cannot be null or empty.");</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;Cache cache;</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;cache = caches.get(name);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if (cache == null) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache = createCache(name);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache existing = caches.putIfAbsent(name, cache);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (existing != null) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache = existing;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p><br></p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;return cache;</p><p>&nbsp;&nbsp;}</p><p><br></p><p><br></p><p>&nbsp;&nbsp;protected abstract Cache createCache(String name) throws CacheException;</p><p><br></p><p><br></p><p>&nbsp;&nbsp;public void destroy() throws Exception {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;while (!caches.isEmpty()) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (Cache cache : caches.values()) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LifecycleUtils.destroy(cache);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;caches.clear();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;}</p><p><br></p><p>&nbsp;&nbsp;public String toString() {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Collection&lt;Cache&gt; values = caches.values();</p><p>&nbsp;&nbsp;&nbsp;&nbsp;StringBuilder sb = new StringBuilder(getClass().getSimpleName())</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.append(" with ")</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.append(caches.size())</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.append(" cache(s)): [");</p><p>&nbsp;&nbsp;&nbsp;&nbsp;int i = 0;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;for (Cache cache : values) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (i &gt; 0) {</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(", ");</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sb.append(cache.toString());</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;&nbsp;sb.append("]");</p><p>&nbsp;&nbsp;&nbsp;&nbsp;return sb.toString();</p><p>&nbsp;&nbsp;}</p><p>}</p><p><br></p>